tests:
  - description: "Kt-Js projects importing and configuring kt-npm-publish should be endowed with a number of tasks"
    configuration:
      tasks: tasks
    expectation:
      output_contains:
        - copyFilesNextToPackageJson
        - npmPublish
        - npmLogin
        - npmLoginSetRegistry
        - npmLoginSetToken
        - liftPackageJson
      output_matches: &output_matches
        - "\\[test-js\\] \\[npmPublishing\\]: Inferred nodeRoot from task :kotlinNodeJsSetup: .*?/nodejs/node-v12.16.1-linux-x64"
        - "\\[test-js\\] \\[npmPublishing\\]: Inferred nodeSetupTask: :kotlinNodeJsSetup"
        - "\\[test-js\\] \\[npmPublishing\\]: Inferred packageJson from task :packageJson: .*?/build/js/packages/test-js/package.json"
        - "\\[test-js\\] \\[npmPublishing\\]: Inferred jsCompileTask: :compileKotlinJs"
        - "\\[test-js\\] \\[npmPublishing\\]: Inferred jsSourcesDir from task :compileKotlinJs: .*?/build/js/packages/test-js/kotlin"
      success: tasks

  - description: "Kt-Js projects importing kt-npm-publish should support npmLogin by only setting up the `token` property"
    configuration:
      tasks: npmLogin
    expectation:
      output_matches: *output_matches
      success: npmLogin

  - description: "Kt-Js projects support compilation as an NPM project"
    configuration:
      tasks: compileKotlinJs
    expectation:
      output_matches: *output_matches
      success: compileKotlinJs
      file_exists:
        - name: "build/js/packages/test-js/package.json"
          contents: '"version": "1.0.0"'
        - name: "build/js/packages/test-js/kotlin/test-js.js"
          contents: "this['test-js']"

  - description: "Kt-Js projects importing and configuring kt-npm-publish support lifting of generated package.json files"
    configuration:
      tasks: liftPackageJson
    expectation:
      output_matches: *output_matches
      success: liftPackageJson
      file_exists:
        - name: "build/js/packages/test-js/package.json"
          contents: '"version": "1.2.3"'